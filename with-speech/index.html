<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>ê³ í’ˆì§ˆ ìŒì„± ì œì–´ ìŠ¤ë§ˆíŠ¸ ë¦¬ë”</title>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      padding: 20px;
      line-height: 1.8;
      max-width: 800px;
      margin: 0 auto;
      color: #333;
      background-color: #f4f7f6;
    }

    #content {
      padding: 30px;
      border: 1px solid #e0e0e0;
      background: #fff;
      margin-bottom: 20px;
      border-radius: 15px;
      font-size: 1.2em;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .status-panel {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #d1d9e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .controls {
      margin-bottom: 30px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      cursor: pointer;
      border-radius: 30px;
      border: none;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .btn-mic {
      background-color: #FF5252;
      color: white;
    }

    .btn-play {
      background-color: #4A90E2;
      color: white;
    }

    .btn-stop {
      background-color: #546E7A;
      color: white;
    }

    button:active {
      transform: scale(0.95);
    }

    /* ê°€ì´ë“œ ì„¹ì…˜ */
    .manual-container {
      padding: 25px;
      background-color: #ffffff;
      border-radius: 15px;
      border: 1px solid #e0e0e0;
    }

    .manual-title {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2C3E50;
      border-left: 5px solid #4A90E2;
      padding-left: 10px;
    }

    .manual-table {
      width: 100%;
      border-collapse: collapse;
    }

    .manual-table td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    .cmd-tag {
      background: #E3F2FD;
      color: #1976D2;
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: bold;
      font-size: 0.9em;
    }

    .tip {
      font-size: 0.85em;
      color: #78909C;
      margin-top: 15px;
    }
  </style>
</head>

<body>

  <h2>ğŸ™ï¸ ê³ í’ˆì§ˆ ìŒì„± ì œì–´ ìŠ¤ë§ˆíŠ¸ ë¦¬ë”</h2>

  <div class="status-panel">
    <div><strong>ìƒíƒœ:</strong> <span id="status" style="color:#4A90E2;">ë§ˆì´í¬ ëŒ€ê¸° ì¤‘</span></div>
    <div><strong>ì¸ì‹ëœ ë§:</strong> <span id="recognized" style="color:#FF5252;">-</span></div>
  </div>

  <div id="content">
    ë™í•´ ë¬¼ê³¼ ë°±ë‘ì‚°ì´ ë§ˆë¥´ê³  ë‹³ë„ë¡ í•˜ëŠë‹˜ì´ ë³´ìš°í•˜ì‚¬ ìš°ë¦¬ë‚˜ë¼ ë§Œì„¸.
    ë¬´ê¶í™” ì‚¼ì²œë¦¬ í™”ë ¤ ê°•ì‚° ëŒ€í•œ ì‚¬ëŒ ëŒ€í•œìœ¼ë¡œ ê¸¸ì´ ë³´ì „í•˜ì„¸.
    ë‚¨ì‚° ìœ„ì— ì € ì†Œë‚˜ë¬´ ì² ê°‘ì„ ë‘ë¥¸ ë“¯ ë°”ëŒ ì„œë¦¬ ë¶ˆë³€í•¨ì€ ìš°ë¦¬ ê¸°ìƒì¼ì„¸.
    ê°€ì„ í•˜ëŠ˜ ê³µí™œí•œë° ë†’ê³  êµ¬ë¦„ ì—†ì´ ë°ì€ ë‹¬ì€ ìš°ë¦¬ ê°€ìŠ´ ì¼í¸ë‹¨ì‹¬ì¼ì„¸.
  </div>

  <div class="controls">
    <button class="btn-mic" onclick="startListening()">ğŸ¤ ìŒì„± ì œì–´ ì‹œì‘</button>
    <button class="btn-play" onclick="handleAction('restart')">ğŸ”„ ì²˜ìŒë¶€í„°</button>
    <button class="btn-stop" onclick="handleAction('stop')">â¹ ì¤‘ë‹¨</button>
  </div>

  <div class="manual-container">
    <div class="manual-title">ğŸ“– ì´ìš© ê°€ì´ë“œ</div>
    <table class="manual-table">
      <tr>
        <td><span class="cmd-tag">"ì²˜ìŒë¶€í„°"</span></td>
        <td>ê°€ì¥ ì²« ë¬¸ì¥ìœ¼ë¡œ ëŒì•„ê°€ ë‚­ë…ì„ ì‹œì‘í•©ë‹ˆë‹¤.</td>
      </tr>
      <tr>
        <td><span class="cmd-tag">"ë©ˆì¶°"</span> ë˜ëŠ” <span class="cmd-tag">"ê·¸ë§Œ"</span></td>
        <td>ì½ê¸°ë¥¼ ì¦‰ì‹œ ì¤‘ë‹¨í•˜ê³  í˜„ì¬ ìœ„ì¹˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</td>
      </tr>
      <tr>
        <td><span class="cmd-tag">"ë‹¤ì‹œ ì‹œì‘"</span> ë˜ëŠ” <span class="cmd-tag">"ì¬ìƒ"</span></td>
        <td>ë©ˆì·„ë˜ ì§€ì ë¶€í„° ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ ì½ìŠµë‹ˆë‹¤.</td>
      </tr>
      <tr>
        <td><span class="cmd-tag">"ì´ì „"</span> ë˜ëŠ” <span class="cmd-tag">"ë’¤ë¡œ"</span></td>
        <td>ì•½ 5ì´ˆ ì „(10ë‹¨ì–´ ì „)ìœ¼ë¡œ ëŒì•„ê°€ ë‹¤ì‹œ ì½ìŠµë‹ˆë‹¤.</td>
      </tr>
    </table>
    <p class="tip">â€» ìŠ¤í”¼ì»¤ ì†Œë¦¬ê°€ ë§ˆì´í¬ë¡œ ë“¤ì–´ê°€ë©´ ì¸ì‹ì´ ì•ˆ ë  ìˆ˜ ìˆìœ¼ë‹ˆ ì´ì–´í° ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
  </div>

  <script>
    const contentDiv = document.getElementById('content');
    const statusText = document.getElementById('status');
    const recognizedText = document.getElementById('recognized');

    // í…ìŠ¤íŠ¸ë¥¼ ë‹¨ì–´ ë‹¨ìœ„ë¡œ ìª¼ê°œì–´ ê´€ë¦¬
    const words = contentDiv.innerText.trim().split(/\s+/);
    let currentWordIndex = 0;
    let isCommandProcessing = false;

    // 1. ìŒì„± ì¸ì‹(STT) ì„¤ì •
    const recognition = new(window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'ko-KR';
    recognition.continuous = false;
    recognition.interimResults = true;

    recognition.onresult = (event) => {
      let transcript = '';
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        transcript += event.results[i][0].transcript;
      }
      recognizedText.innerText = transcript;

      if (isCommandProcessing) return;

      if (transcript.includes("ì²˜ìŒë¶€í„°")) handleAction('restart');
      else if (transcript.includes("ë©ˆì¶°") || transcript.includes("ê·¸ë§Œ")) handleAction('stop');
      else if (transcript.includes("ë‹¤ì‹œ ì‹œì‘") || transcript.includes("ì¬ìƒ")) handleAction('resume');
      else if (transcript.includes("ì´ì „") || transcript.includes("ë’¤ë¡œ")) handleAction('back');
    };

    function handleAction(action) {
      isCommandProcessing = true;
      if (action === 'restart') {
        currentWordIndex = 0;
        speakFrom(0);
      } else if (action === 'stop') {
        stopSpeaking();
      } else if (action === 'resume') {
        speakFrom(currentWordIndex);
      } else if (action === 'back') {
        stopSpeaking();
        currentWordIndex = Math.max(0, currentWordIndex - 10);
        setTimeout(() => speakFrom(currentWordIndex), 300);
      }

      recognition.stop();
      setTimeout(() => {
        isCommandProcessing = false;
      }, 1000);
    }

    recognition.onend = () => {
      try {
        recognition.start();
      } catch (e) {}
    };

    function startListening() {
      try {
        recognition.start();
        statusText.innerText = "ëª…ë ¹ ëŒ€ê¸° ì¤‘...";
      } catch (e) {}
    }

    // 2. ìŒì„± í•©ì„±(TTS) ê°•í™” í•¨ìˆ˜
    function speakFrom(index) {
      window.speechSynthesis.cancel();

      const textToSpeak = words.slice(index).join(' ');
      const utterance = new SpeechSynthesisUtterance(textToSpeak);

      // ëª©ì†Œë¦¬ ê°•í™” ì„¤ì •
      utterance.lang = 'ko-KR';
      utterance.rate = 0.85; // ì•½ê°„ ì²œì²œíˆ ì½ì–´ ë‚­ë…ì˜ ëŠë‚Œì„ ì‚´ë¦¼
      utterance.pitch = 1.0; // í‘œì¤€ ìŒë†’ì´
      utterance.volume = 1.0; // ë³¼ë¥¨ ìµœëŒ€

      // í•œêµ­ì–´ ê³ ìœ ì˜ ëŠì–´ ì½ê¸°ë¥¼ ìœ„í•´ ë§ˆì¹¨í‘œ ë’¤ì— ë¯¸ì„¸í•œ íœ´ì§€ê¸°(Pause) ëŠë‚Œ ë¶€ì—¬
      // (ê¸°ë³¸ APIì—ì„œ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì†ë„ ì¡°ì ˆë¡œ ìµœì í™”)

      utterance.onboundary = (event) => {
        if (event.name === 'word') {
          const spoken = event.utterance.text.substring(0, event.charIndex);
          currentWordIndex = index + spoken.trim().split(/\s+/).length - 1;
        }
      };

      utterance.onstart = () => {
        statusText.innerText = "ë‚­ë… ì¤‘...";
      };
      utterance.onend = () => {
        statusText.innerText = "ëª…ë ¹ ëŒ€ê¸° ì¤‘";
      };

      window.speechSynthesis.speak(utterance);
    }

    function stopSpeaking() {
      window.speechSynthesis.cancel();
      statusText.innerText = "ì¼ì‹œ ì •ì§€ë¨";
    }
  </script>
</body>

</html>