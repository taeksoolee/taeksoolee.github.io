<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%><%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<style>
  .dismissButton {
    display: none;
  }

  .custom-menu {
    z-index: 1000;
    position: absolute;
    background-color: rgba(0, 0, 0, .6);
    border: 0px solid black;
    color: #fff;
    width: auto;
    padding: .25rem 1rem;

  }

  :root {
    --geo-img-width: 70rem;
    --geo-img-height: 27rem;
  }

  .ts-nav-link {
    color: white !important;
    cursor: pointer;
  }

  .ts-nav-link.active {
    color: #8fc31f !important;
  }

  .geo-fullscreen-btn {
    position: absolute;
    bottom: 0;
    right: 0;
    color: white;
    border: 1px solid white;
    font-size: 1rem;
    margin: 1rem;
    cursor: pointer;
    padding: .3rem;
  }

  .fullscreen-geo {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
  }

  @-webkit-keyframes blinker {
    from {
      opacity: 1.0;
    }

    to {
      opacity: 0.0;
    }
  }

  .danger {
    text-decoration: blink;
    -webkit-animation-name: blinker;
    -webkit-animation-duration: 0.6s;
    -webkit-animation-iteration-count: infinite;
    -webkit-animation-timing-function: ease-in-out;
    -webkit-animation-direction: alternate;
    color: red !important;
  }
</style>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>

<script src="/js/ts/chart.js"></script>
<script src="/js/ts/demo.js"></script>

<div ng-app="app">

  <nav class="navbar navbar-expand navbar-dark static-top" style="height: 60px;padding:.6rem 2%;"
    ng-controller="NavCtrl">
    <a class="navbar-brand mr-1" href="index.html">
      <img class="logo_img" src="/images/nc_logo.png" alt="logo">
    </a>
    <p style="font-size:1.4rem;padding:0 1rem;margin:0;color:#fff;">디지털 안전 작업관리 시스템</p>

    <ul class="navbar-nav col-xl-9 ml-auto pl-2 pr-0">
      <li class=" dashboard-safety-nav mr-3 text-white p-2 pr-4 rounded">
        <select class="dashboard-select">
          <option ng-repeat="item in factoryNameList" v-bind="item">{{item}}</option>
        </select>
      </li>
      <li class=" dashboard-safety-nav text-white p-2 pr-4 rounded">
        <i class="fas fa-calendar-alt text-warning"></i>
        <input class="dashboard-select" type="text" ng-model="selectedDay" readonly>
      </li>

      <li class="ml-auto text-white p-2 pr-3 rounded-left dashboard-safety-nav" style="display:none;">
        오늘의 안전교육
        <i class="fas fa-hard-hat text-warning"></i>
      </li>
      <li class=" text-white p-2 pr-4 rounded-right dashboard-safety-nav" style="display:none;">
        <select class="dashboard-select">
          <option value="">안전 보호구 착용 철저1</option>
          <option value="">안전 보호구 착용 철저2</option>
          <option value="">안전 보호구 착용 철저3</option>
          <option value="">안전 보호구 착용 철저4</option>
        </select>
      </li>
    </ul>
  </nav>

  <div class="content-wrapper dashboard-wrap" ng-controller="MainCtrl">
    <div class="dashboard-container">
      <div class="row" style="height:calc(25% - 1rem)">
        <div class="col-xl-3 h-100">
          <div class="card job_situation border-0 h-100">
            <div class="card-body m-0 p-0">
              <div class="w-50 mt-2">작업 현황(일 별)</div>
              <ul>
                <li ng-repeat="item in workStatus">
                  <p>{{item.n}}</p>
                  <div>{{item.v}}</div>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-xl-9  h-100">
          <div class="card border-0 h-100">
            <div class="card-body m-0 p-0 border-0">
              <ul class="dashboard-count-wrap01 h-100">
                <li class="h-100">
                  <p>/</p>
                  <p>작업중(일 별)</p>
                  <p>전체발행작업(월 별)</p>
                </li>
                <li class="h-100" ng-repeat="item in workDivision">
                  <p><i class="fas fa-circle pr-2"></i>{{item.n}}</p>
                  <!-- working value -->

                  <p ng-click="openWorkListModal(item.id)" style="cursor:pointer;"
                    ng-class="{danger: item.n === '방사선'}">{{item.wv}}</p> <!-- fn_working -->
                  <!-- total value -->
                  <p ng-click="openTotalListModal(item.id)" style="cursor:pointer;">{{item.tv}}</p> <!-- fn_total -->
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3" style="height:calc(25% - 1rem)">
        <div class="col-xl-3 h-100">
          <div class="card job_people border-0 h-100">
            <div class="card-body m-0 p-0 h-100">
              <div class="w-50 mt-2">작업 인원(일 별)</div>
              <ul>
                <li ng-repeat="item in workPersonel">
                  <p>{{item.n}}</p>
                  <div class="" id="WORKER_TOTAL">{{item.v}}</div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-xl-9 h-100">
          <div class="card border-0 h-100">
            <div class="card-header">
              <i class="far fa-circle text-olive"></i> 작업사진
            </div>
            <div class="card-body m-0 p-4" style="height:calc(50% - 42px);">
              <ul id="ORDER_LIST_WARP" class="bxslider1 h-100 m-auto"
                style="display:flex; justify-content: space-between; padding: 0;">
                <li ng-repeat="item in workImageList"
                  style="display: inline-block !important; text-align: center; width: 15%;">
                  <img class="h-100" style="height: 95% !important; width: 100%; width: 100%;" ng-src="{{item.s}}">
                  <p style="color: white; text-align: center; margin-bottom: 0; margin-top: 0rem;">{{item.n}}</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3" style="height:calc(50% - 1rem)">
        <div class="col-xl-6 h-100" ng-class="{'col-xl-12': isFullScreenGeo ,'fullscreen-geo': isFullScreenGeo}">
          <div class="card border-0 h-100">
            <div class="card-body m-0 p-0 h-100">
              <div class="h-100 w-100" id="mapGps" style="position: absolute;" oncontextmenu='return false'>
              </div>
              <div class="card-nav" style="
                        	position: absolute;
                        	z-index: 2;">
                <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"
                  style="
                                display: flex;
							    flex-direction: row !important;
							    flex-wrap: nowrap;
							    justify-content: space-between;
							    width: 100%;">
                  <a class="toggle-card-nav" href="#"><i class="fas fa-caret-square-left"></i></a>

                  <a class="nav-link ts-nav-link" ng-click="setMapIcon($event, 'all');"
                    ng-class="{active: selectedDivisionId === 'all'}">전체</a>
                  <a ng-repeat="item in workDivision" class="nav-link ts-nav-link"
                    ng-click="setMapIcon($event, item.id);"
                    ng-class="{active: selectedDivisionId === item.id}">{{item.n}}</a>
                </div>
              </div>

              <div class="card-nav-select" style="
                        	position: absolute;
                        	z-index: 2;">
                <select ng-model="selectedFacotryName" ng-change="handleChangeFactorySource();">
                  <option ng-repeat="item in factorySource" ng-value="item.n">{{item.n}}</option>
                </select>
              </div>

              <div class="h-100">
                <div class="tab-content w-100 h-100">
                  <div class="tab-pane w-100 h-100 fade show active" style="text-align: center;">
                    <img class="" ng-src="{{selectedFacotrySrc}}" style="
                                    	width: var(--geo-img-width);
									    height: var(--geo-img-height);" />
                    <div style="
	                                    position: relative;
									    width: var(--geo-img-width);
									    height: var(--geo-img-height);
									    top: calc(0% - var(--geo-img-height));
									    left: 0;
									    margin: 0 auto;">
                      <div ng-repeat="item in renderMarkerList" marker-template ng-value="item"
                        ng-style="getPosition(item)" ng-style="
                                    		position: absolute;" ng-isImportant="{{item.isImportant}}">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="geo-fullscreen-btn" ng-click="doFullScreenGeo()">
                  <i class="fas fa-compress-arrows-alt"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-6 h-100">
          <div class="card border-0" style="height:calc(50% - .5rem)">
            <div class="card-header">
              <div class="w-100 d-flex justify-content-between h-100">
                <div>
                  <i class="far fa-circle text-olive"></i> IoT 가스 센서
                </div>
                <div class="float-right d-flex align-items-center">
                  <i class="fas fa-play-circle text-white pr-2" onclick="fn_start();"
                    style="font-size:1.6rem;display:none;" id="graphStart"></i>
                  <select id="gasList" onchange="fn_gas();" class="pr-0"
                    style="color:white;border:0;background: linear-gradient(to bottom, #22282e 0%, #343a41 100%) !important; width:400px;">
                  </select>
                </div>
              </div>
            </div>

            <div class="card-body m-0 p-4" style="height:calc(50% - 10px);">
              <div class="w-100 d-flex justify-content-between h-100">
                <div chart-template chart-id="IOTChart_01" chart-text="CO2"></div>
                <div chart-template chart-id="IOTChart_02" chart-text="HC"></div>
                <div chart-template chart-id="IOTChart_03" chart-text="CO"></div>
                <div chart-template chart-id="IOTChart_04" chart-text="CO2"></div>
                <div chart-template chart-id="IOTChart_05" chart-text="H25"></div>
              </div>
            </div>
          </div>
          <div class="card border-0  mt-3" style="height:calc(50% - .5rem)">
            <div class="card-header">
              <i class="far fa-circle text-olive"></i> 오늘의 안전신문고
              <!-- <span>신고:<span>56건</span>| 완료 : <span>30건</span> </span> -->
            </div>
            <div class="card-body m-0 p-4" style="height:calc(50% - 42px);">
              <ul id="SINMUNGO_IMG_WARP" class="bxslider3 h-100 m-auto"
                style="display: flex; justify-content: space-between; padding: 0;">
                <li ng-repeat="item in sinmungoImageList">
                  <img class="w-100 h-100" ng-src="{{item.s}}" style="padding: 10px;">
                  <p>{{item.n}}</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="list-modal modal" tabindex="-1" role="dialog" id="list-modal" ng-controller="ListModalCtrl">
    <div class="modal-dialog modal-xl" role="document" style='max-width: 1280px;'>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">작업허가서 조회</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div>
          <table class="table table-hover">
            <colgroup>
              <col width="226px;">
              <col width="68px;">
              <col width="707px;">
              <col width="140px;">
              <col width="137px;">
            </colgroup>
            <thead>
              <tr>
                <th scope="col">발행번호</th>
                <th scope="col">구분</th>
                <th scope="col">작업명</th>
                <th scope="col">팀명</th>
                <th scope="col">발행일</th>
              </tr>
            </thead>
            <tbody id="modal_tbody">
              <tr ng-if="!isZeroListLength" ng-repeat="item in list">
                <th>{{item.no}}</th>
                <th>{{item.division}}</th>
                <th>{{item.title}}</th>
                <th>{{item.team}}</th>
                <th>{{item.regdate}}</th>
              </tr>
              <tr ng-if="isZeroListLength">
                <th colspan='5' style='text-align: center;'>진행중인 작업이 없습니다.</th>
              </tr>
            </tbody>
            <tfoot id="modal_tfoot"></tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!--Map Enlarged Image Modal-->
  <div class="list-modal modal" tabindex="-1" role="dialog" id="map_enlarged" ng-controller="MapModalCtrl">
    <div class="col-xl-12 h-100" role="document">
      <div class="modal-content h-100">
        <div class="modal-header">
          <h5 class="modal-title"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="col-xl-12 h-100">
          <div class="card border-0 h-100">
            <div class="card-body m-0 p-0 h-100">
              <div class="h-100 w-100" id="mapGps_pop" style="position: absolute;" oncontextmenu='return false'></div>
              <div class="card-nav" style="position: absolute;">
                <div class="nav flex-column nav-pills" id="v-pills-tab_pop" role="tablist" aria-orientation="vertical">
                  <a class="toggle-card-nav" href="#"><i class="fas fa-caret-square-left"></i></a>

                  <a class="nav-link active" onclick="setMap_pop('all');" id="v-pills-all-tab" data-toggle="pill"
                    href="" role="tab" aria-controls="v-pills-all" aria-selected="true">전체</a>

                  <a ng-repeat="item in workDivision" class="nav-link" onclick="setMap(1003);" id="v-pills-03-tab"
                    data-toggle="pill" href="" role="tab" aria-controls="v-pills-03" aria-selected="false">{{item.n}}
                  </a>
                </div>
              </div>

              <div class="card-nav-select" style="position: absolute;">
                <select id="selectGps_pop">
                  <option>GEO</option>
                  <option>PE</option>
                </select>&nbsp;&nbsp;
                <input type="button" class="btn btn-secondary  float-right" data-dismiss="modal" aria-label="Close"
                  value="닫기" style="width:104px;height:40px" />
              </div>

              <div class="h-100">
                <div class="tab-content w-100 h-100" id="v-pills-tabContent_pop">
                  <div class="tab-pane w-100 h-100 fade show active" id="v-all-all_pop" role="tabpanel"
                    aria-labelledby="v-pills-all-tab">
                    <img class="w-100 h-100" style="" id="FACTORY_IMG_pop" src="">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  var app = angular.module('app', []);
  app.value('wordMap', {});

  app.value('workDivision', [
    { n: '일반', id: '1001' }, //normal 
    { n: '화기', id: '1002' }, // fire
    { n: '입조', id: '1003' }, // sentryduty
    { n: '굴착', id: '1005' }, // excavation
    { n: '전기', id: '1004' }, // elec
    { n: '방사선', id: '1006' }, // radiation       	
  ]);

  app.value('factorySource', [
    { n: 'GEO', s: '/images/daesanGEO.PNG' },
    { n: 'PE', s: '/images/daesanPE.PNG' },
  ]);

  // init
  app.run(['$rootScope', 'utilService', function ($rootScope, utils) {
    // today
    $rootScope.selectedDay = utils.getTodayString();
  }]);

  app.controller('NavCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', function ($el, $rootScope, $scope, utils, ajax, wordMap) {
    // db에서 가져올 경우
    /* const factoryList = await ajax.post('/sinmungo/getFactory.do', null);
  	
    $scope.factoryNameList = [];
  	
    factoryList.forEach(function(f, i) {
      if($scope.factoryNameList.find(sf => sf === f.FACTORY ) === undefined) {			
        $scope.factoryNameList.push(f.FACTORY)
      }
    });
  	
    $scope.$apply(); */

    // 하드코딩
    $scope.factoryNameList = ['당진 화력발전소'];


  }]);

  app.controller('MainCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', 'workDivision', 'factorySource', function ($el, $rootScope, $scope, utils, ajax, wordMap, workDivision, factorySource) {
    $scope.workList = ajax.getWorkListDemo();

    $scope.factorySource = factorySource;
    $scope.selectedFacotryName = factorySource[0].n;
    $scope.selectedFacotrySrc = factorySource[0].s;

    $scope.$watch('selectedFacotryName', function (name) {
      // set image source
      const findItem = $scope.factorySource.find(function (item) {
        return item.n === name;
      });

      $scope.selectedFacotrySrc = findItem.s;

      // set marker [all]
      $scope.renderMarkerList = $scope.markerList.filter(function (m) {
        return m.factory === name;
      });

      $scope.selectedDivisionId = 'all';
    });

    // 작업현황 : 일별
    $scope.workStatus = [
      { n: '전체', v: 0 },
      { n: '진행중', v: 0 },
      { n: '완료', v: 0 },
      // {n: '대기', v: 0},
    ];

    // 작업인원 : 일별
    $scope.workPersonel = [
      { n: '투입', v: 0 },
      { n: '작업중', v: 0 },
      { n: '작업완료', v: 0 }
    ];

    // 작업별 작업횟수
    // wv(working value) : 일별, tv(totalValue) : 월별
    $scope.workDivision = workDivision;

    // 작업목록 하드코딩
    $scope.workImageList = [
      { n: '전기 작업_202011501', s: '/images/ts/sm1.jpg' },
      { n: '굴착 작업_202011502', s: '/images/ts/sm2.jpg' },
      { n: '화기 작업_202011503', s: '/images/ts/sm3.jpg' },
      { n: '화기 작업_202011504', s: '/images/ts/sm4.jpg' },
      { n: '일반작업_2020111505 ', s: '/images/ts/sm5.jpg' },
      { n: '일반작업_2020111505 ', s: '/images/ts/sm6.jpg' },
    ];

    // 신문고 사진 목록 하드코딩
    $scope.sinmungoImageList = [
      { n: 'A구역 | 기계오작동', s: '/images/ts/sm9.png' },
      { n: 'B구역 | 기계오작동', s: '/images/ts/sm5.jpg' },
      { n: 'A구역 | 수리요청', s: '/images/ts/sm6.jpg' },
      { n: 'B구역 | 수리요청', s: '/images/ts/sm7.jpg' },
      { n: 'C구역 | 기타', s: '/images/ts/sm8.jpg' },
    ];

    // list modal
    $scope.openWorkListModal = async function (workcd) {
      // var workList = await ajax.post('/lotte/ts/getworkinglist.nDo', {"WORKCD":  workcd});
      const workList = $scope.workList.filter(function (w) {
        return w.id === workcd;
      });

      $rootScope.$emit('get:workList', workList);
    }

    $scope.openTotalListModal = async function (workcd) {
      // var workList = await ajax.post('/lotte/ts/gettotallist.nDo', {"WORKCD":  workcd});
      $rootScope.$emit('get:workList', workList);
    }

    $scope.markerList = $scope.workList.map(function (w) {
      return {
        top: w.top,
        left: w.left,
        id: w.id,
        title: w.title,
        factory: w.factory,
        workerCnt: w.workerCnt,
        isImportant: w.important
      }
    });
    $scope.selectedDivisionId = 'all';

    /* [
     {top: 33, left: 12, id: '1001', factory: 'PE', workCnt: 1},
     {top: 8, left: 10, id: '1002', factory: 'PE', workCnt: 3},
     {top: 40, left: 10, id: '1003', factory: 'PE', workCnt: 3},
     {top: 20, left: 10, id: '1003', factory: 'PE', workCnt: 1},
     {top: 30, left: 60, id: '1004', factory: 'PE', workCnt: 2},
     {top: 50, left: 40, id: '1005', factory: 'PE', workCnt: 1},
     {top: 30, left: 5, id: '1004', factory: 'PE', workCnt: 3},
     {top: 80, left: 25, id: '1006', factory: 'PE', workCnt: 4},
     
     {top: 30, left: 30, id: '1001', factory: 'GEO', workCnt: 1},
     {top: 10, left: 34, id: '1001', factory: 'GEO', workCnt: 1},
     {top: 23, left: 33, id: '1001', factory: 'GEO', workCnt: 1},
     {top: 40, left: 2, id: '1002', factory: 'GEO', workCnt: 2},
     {top: 30, left: 70, id: '1003', factory: 'GEO', workCnt: 5},
     {top: 20, left: 10, id: '1004', factory: 'GEO', workCnt: 1},
     {top: 30, left: 20, id: '1005', factory: 'GEO', workCnt: 2},
     {top: 40, left: 30, id: '1006', factory: 'GEO', workCnt: 3},
   ]; */

    $scope.renderMarkerList = $scope.markerList.filter(function (m) {
      return m.factory === $scope.selectedFacotryName;
    });

    $scope.getPosition = function (item) {
      let color = 'rgba(100, 100, 100, 1)';
      switch (item.id) {
        case '1001': // 일반
          color = '#2f7fb4';
          break;
        case '1002': // 화기
          color = '#af2f74';
          break;
        case '1003': // 입조
          color = '#5e9213';
          break;
        case '1004': // 전기
          color = '#b17702';
          break;
        case '1005': // 굴착
          color = '#8d43b9';
          break;
        case '1006': // 방사선
          color = '#dd0b2e';
          break;
      }


      return { top: item.top + '%', left: item.left + '%', color: color };
    }

    $scope.setMapIcon = function (e, id) {
      $scope.selectedDivisionId = id;

      const markerList = $scope.markerList.filter(function (m) {
        return m.factory === $scope.selectedFacotryName;
      });

      if (id === 'all') {
        $scope.renderMarkerList = markerList;
        return;
      }

      $scope.renderMarkerList = markerList.filter(function (m) {
        return m.id === id;
      });

    }

    $scope.isFullScreenGeo = false;
    $scope.doFullScreenGeo = function () {
      $scope.isFullScreenGeo = !$scope.isFullScreenGeo;
      console.log('$scope.isFullScreenGeo', $scope.isFullScreenGeo)

      if ($scope.isFullScreenGeo) {
        document.documentElement.style.setProperty('--geo-img-width', '100rem');
        document.documentElement.style.setProperty('--geo-img-height', '75rem');
      } else {
        document.documentElement.style.setProperty('--geo-img-width', '70rem');
        document.documentElement.style.setProperty('--geo-img-height', '27rem');
      }
    }

    init();

    async function init() {
      /*
      const {
        CURRENT_COUNT,
        CURRENT_WORKER_COUNT,
        TOTAL_COUNT,
        TOTAL_WORK_COUNT,
      } = await ajax.get('/lotte/selectDashBoardCount.nDo');
      */
      console.log('init markerlist!', $scope.markerList);

      let workerCnt = 0;
      for (item of $scope.markerList) {
        workerCnt += item.workerCnt
      }

      const {
        CURRENT_COUNT,
        CURRENT_WORKER_COUNT,
        TOTAL_COUNT,
        TOTAL_WORK_COUNT,
      } = {
        CURRENT_COUNT: {
          COMPLETED: 3,
          RUNNING: $scope.markerList.length,
          WAITING: 1,
        },
        CURRENT_WORKER_COUNT: {
          COMPLECOUNT: 13,
          NOWCNT: workerCnt,
        },
        TOTAL_COUNT: {
          NORMAL_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1001' }).length,
          FIRE_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1002' }).length,
          SENTRYDUTY_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1003' }).length,
          ELEC_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1004' }).length,
          EXCAVATION_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1005' }).length,
          RADIATION_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1006' }).length,
        },
        TOTAL_WORK_COUNT: {
          ELEC_WORKING: 20,
          EXCAVATION_WORKING: 10,
          FIRE_WORKING: 40,
          NORMAL_WORKING: 20,
          RADIATION_WORKING: 22,
          SENTRYDUTY_WORKING: 15,
        },
      };

      // db set
      $scope.workStatus.find(w => w.n === '전체').v = CURRENT_COUNT.COMPLETED + CURRENT_COUNT.RUNNING + CURRENT_COUNT.WAITING
      $scope.workStatus.find(w => w.n === '진행중').v = CURRENT_COUNT.RUNNING
      $scope.workStatus.find(w => w.n === '완료').v = CURRENT_COUNT.COMPLETED
      // $scope.workStatus.find(w => w.n === '대기').v = CURRENT_COUNT.WAITING

      $scope.workPersonel.find(w => w.n === '투입').v = CURRENT_WORKER_COUNT.NOWCNT + CURRENT_WORKER_COUNT.COMPLECOUNT;
      $scope.workPersonel.find(w => w.n === '작업중').v = CURRENT_WORKER_COUNT.NOWCNT;
      $scope.workPersonel.find(w => w.n === '작업완료').v = CURRENT_WORKER_COUNT.COMPLECOUNT;

      const ELEC_TOTAL = $scope.workDivision.find(wc => wc.n === '전기');
      const EXCAVATION_TOTAL = $scope.workDivision.find(wc => wc.n === '굴착');
      const FIRE_TOTAL = $scope.workDivision.find(wc => wc.n === '화기');
      const NORMAL_TOTAL = $scope.workDivision.find(wc => wc.n === '일반');
      const RADIATION_TOTAL = $scope.workDivision.find(wc => wc.n === '방사선');
      const SENTRYDUTY_TOTAL = $scope.workDivision.find(wc => wc.n === '입조');

      ELEC_TOTAL.wv = TOTAL_COUNT.ELEC_TOTAL;
      ELEC_TOTAL.tv = TOTAL_WORK_COUNT.ELEC_WORKING;

      EXCAVATION_TOTAL.wv = TOTAL_COUNT.EXCAVATION_TOTAL;
      EXCAVATION_TOTAL.tv = TOTAL_WORK_COUNT.EXCAVATION_WORKING;

      FIRE_TOTAL.wv = TOTAL_COUNT.FIRE_TOTAL;
      FIRE_TOTAL.tv = TOTAL_WORK_COUNT.FIRE_WORKING;

      NORMAL_TOTAL.wv = TOTAL_COUNT.NORMAL_TOTAL;
      NORMAL_TOTAL.tv = TOTAL_WORK_COUNT.NORMAL_WORKING;

      RADIATION_TOTAL.wv = TOTAL_COUNT.RADIATION_TOTAL;
      RADIATION_TOTAL.tv = TOTAL_WORK_COUNT.RADIATION_WORKING;

      SENTRYDUTY_TOTAL.wv = TOTAL_COUNT.SENTRYDUTY_TOTAL;
      SENTRYDUTY_TOTAL.tv = TOTAL_WORK_COUNT.SENTRYDUTY_WORKING;

      const bodyObj = {
        search_date_start: $rootScope.selectedDay,
        search_date_end: $rootScope.selectedDay,
        search_impo_type: "",
        search_report_title: "",

        search_action_status: "",
        search_department: "",
        search_position: ""
      }

      // const cntGraph = await ajax.post('/sinmungo/ts/getCntGraph.nDo', bodyObj);

      //demo code - 하드코딩...
      fn_makeIOTChart(getChartDemoDataAll());
    }

  }]);
  app.controller('ListModalCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', function ($el, $rootScope, $scope, utils, ajax, wordMap) {
    $scope.list = [];
    $scope.isZeroListLength = true;

    $rootScope.$on('get:workList', function (_, list) {
      console.log('get:workList', list);
      $scope.list = list;

      $el.modal('show');
    });

    $scope.$watch('list', function (list) {
      console.log(list);
      $scope.isZeroListLength = list.length === 0;
      console.log('zerolength', $scope.isZeroListLength);
    })


  }]);

  app.controller('MapModalCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', 'workDivision', function ($el, $rootScope, $scope, utils, ajax, wordMap, workDivision) {
    $scope.workDivision = workDivision;
  }]);


  app.service('utilService', function () {
    this.reverse = function (name) {
      return name.split("").reverse().join("");
    };

    this.getTodayString = function () {
      var today = new Date();
      var dd = today.getDate();
      var mm = today.getMonth() + 1;
      var yyyy = today.getFullYear();

      dd = dd < 10 ? '0' + dd : dd;
      mm = mm < 10 ? '0' + mm : mm;

      today = yyyy + '-' + mm + '-' + dd;

      return today;
    };


  });

  app.factory('ajaxFacotry', function ($compile) {
    return {
      get: function (url, params, preResCb, preRejCb) {
        return new Promise(function (res, rej) {
          $.ajax({
            url: url,
            contentType: "application/json",
            dataType: 'json',
            params: params,
            success: function (result) {
              if (typeof (preResCb) === 'function') preResCb();
              res(result);
            },
            error: function (err) {
              if (typeof (preRejCb) === 'function') preRejCb();
              rej(err);
            }
          });
        });
      },
      post: function (url, data, preResCb, preRejCb) {
        return new Promise(function (res, rej) {
          $.ajax({
            url: url,
            type: 'POST',
            contentType: "application/json",
            dataType: 'json',
            data: data,
            success: function (result) {
              if (typeof (preResolveCb) === 'function') preResolveCb();
              res(result);
            },
            error: function (err) {
              if (typeof (preRejectCb) === 'function') preRejectCb();
              rej(err);
            }
          });
        });
      },
      getWorkListDemo: function () {
        // hard coding
        return [
          { no: 1, id: '1002', division: '화기', title: '[PE] 공장 뒤 용접작업', team: 'A팀', regdate: '2020-11-20', workerCnt: 2, top: 3, left: 77, factory: 'PE', important: false },
          { no: 2, id: '1001', division: '일반', title: '[GEO] 작업장 뒤 용접작업', team: 'B팀', regdate: '2020-11-21', workerCnt: 4, top: 22, left: 56, factory: 'GEO', important: false },
          { no: 3, id: '1001', division: '일반', title: '[PE] 쓰레기 청소작업', team: 'C팀', regdate: '2020-11-21', workerCnt: 3, top: 15, left: 78, factory: 'PE', important: false },
          { no: 4, id: '1004', division: '전기', title: '[GEO] 1층 전선작업', team: 'Z팀', regdate: '2020-11-21', workerCnt: 2, top: 20, left: 55, factory: 'GEO', important: false },
          { no: 5, id: '1005', division: '굴착', title: '[PE] 공장 앞 굴착 작업', team: 'E팀', regdate: '2020-11-21', workerCnt: 1, top: 67, left: 43, factory: 'PE', important: false },
          { no: 6, id: '1003', division: '입조', title: '[PE] 작업장 뒤 입조작업', team: 'R팀', regdate: '2020-11-21', workerCnt: 3, top: 30, left: 22, factory: 'PE', important: false },
          { no: 7, id: '1001', division: '일반', title: '[GEO] 기타 일반작업', team: 'A팀', regdate: '2020-11-21', workerCnt: 5, top: 28, left: 41, factory: 'GEO', important: false },
          { no: 8, id: '1004', division: '전기', title: '[PE] 작업장 뒤 전기작업', team: 'E팀', regdate: '2020-11-21', workerCnt: 2, top: 77, left: 6, factory: 'PE', important: false },
          { no: 9, id: '1002', division: '화기', title: '[PE] 소화 시설 테스트', team: 'A팀', regdate: '2020-11-21', workerCnt: 3, top: 65, left: 98, factory: 'PE', important: false },
          { no: 10, id: '1001', division: '일반', title: '[GEO] 시설물 교육', team: 'B팀', regdate: '2020-11-21', workerCnt: 4, top: 46, left: 7, factory: 'GEO', important: false },
          { no: 11, id: '1002', division: '화기', title: '[GEO] 작업장 뒤 용접작업', team: 'E팀', regdate: '2020-11-21', workerCnt: 5, top: 79, left: 43, factory: 'GEO', important: false },
          { no: 12, id: '1006', division: '방사선', title: '[PE] * 방사선 작업', team: 'D팀', regdate: '2020-11-21', workerCnt: 2, top: 27, left: 68, factory: 'PE', important: false },
          { no: 13, id: '1004', division: '전기', title: '[PE] 건물 내 전기작업', team: 'A팀', regdate: '2020-11-22', workerCnt: 1, top: 47, left: 34, factory: 'PE', important: false },
          { no: 14, id: '1003', division: '입조', title: '[GEO] 제초 작업', team: 'F팀', regdate: '2020-11-22', workerCnt: 3, top: 4, left: 23, factory: 'GEO', important: false },
          { no: 15, id: '1001', division: '일반', title: '[PE] 안전 작업', team: 'K팀', regdate: '2020-11-22', workerCnt: 4, top: 87, left: 56, factory: 'PE', important: true },
          { no: 16, id: '1006', division: '방사선', title: '[GEO] * 방사선 작업', team: 'E팀', regdate: '2020-11-22', workerCnt: 1, top: 56, left: 76, factory: 'GEO', important: false },
          { no: 17, id: '1002', division: '화기', title: '[PE] 일반 화기 작업', team: 'F팀', regdate: '2020-11-22', workerCnt: 3, top: 53, left: 36, factory: 'PE', important: false },
          { no: 18, id: '1002', division: '화기', title: '[PE] 화기작업시 안전교육', team: 'Z팀', regdate: '2020-11-22', workerCnt: 3, top: 80, left: 56, factory: 'PE', important: false },
          { no: 19, id: '1005', division: '굴착', title: '[GEO] 굴착기 테스트', team: 'Y팀', regdate: '2020-11-22', workerCnt: 2, top: 34, left: 34, factory: 'GEO', important: true },
          { no: 20, id: '1003', division: '입조', title: '[PE] 입조 작업', team: 'E팀', regdate: '2020-11-22', workerCnt: 2, top: 76, left: 23, factory: 'PE', important: false },
          { no: 21, id: '1004', division: '전기', title: '[GEO] 전체 전선 테스트', team: 'B팀', regdate: '2020-11-22', workerCnt: 4, top: 27, left: 43, factory: 'GEO', important: false },
          { no: 22, id: '1001', division: '일반', title: '[GEO] 기타 일반작업', team: 'C팀', regdate: '2020-11-23', workerCnt: 5, top: 69, left: 78, factory: 'GEO', important: false },
          { no: 23, id: '1005', division: '굴착', title: '[PE] 실외 굴착 작업', team: 'R팀', regdate: '2020-11-23', workerCnt: 2, top: 81, left: 63, factory: 'PE', important: false },
          { no: 24, id: '1001', division: '일반', title: '[PE] 화장실 청소 작업', team: 'D팀', regdate: '2020-11-23', workerCnt: 3, top: 34, left: 33, factory: 'PE', important: false },
          { no: 25, id: '1004', division: '전기', title: '[GEO] 전선 정리작업', team: 'E팀', regdate: '2020-11-23', workerCnt: 1, top: 66, left: 23, factory: 'GEO', important: false },
          { no: 26, id: '1004', division: '전기', title: '[PE] 전선 정리작업', team: 'Q팀', regdate: '2020-11-23', workerCnt: 2, top: 34, left: 13, factory: 'PE', important: false },
        ]
      }
    }
  });

  app.directive('chartTemplate', function () {
    return {
      restrict: 'A',
      template: `
	    	<div class="" style="width:100%; height:100%; border-radius:10px;">
               	<div class="chart-div" style="width : 90%;  height : 90%; margin-right:2%;"></div>
                <div class="chart-text"style="width : 100%;  height : 10%; color:white; text-align:center;">
                	<span>template</span>
                </div>
            </div>
	    `,
      priority: 0,
      transclude: false,
      scope: false,
      controller: function ($scope, $element, $attrs, $transclude) {
        $element.css('flex', '1');
        $element.find('.chart-div').attr('id', $attrs.chartId);
        $element.find('.chart-text').find('span').text($attrs.chartText);
      },
    };
  });

  app.directive('markerTemplate', function () {
    return {
      restrict: 'A',
      template: `
    			<i class="fas fa-map-marker-alt"></i>
    		`,
      priority: 0,
      transclude: false,
      scope: false,
      controller: function ($scope, $element, $attrs, $transclude) {
        $element
          .css('display', 'inline-block')
          .css('position', 'absolute')
          // .css('color', 'rgba(255,80,80,1)')
          .css('fontSize', '3rem');

        if ($scope.item.isImportant) {
          $element.find('i')
            .css('transform', 'scale(1.3)')
            .addClass('danger');
          //	.css('border', '1px solid red');


          const $div = $('<div></div>');

          $element.append(
            $div
              .css('position', 'absolute')
              .css('top', '1rem')
              .css('left', '3rem')
              .css('z-index', '100000')
              .css('background-color', 'rgba(10,0,0,.7)')
              .css('font-size', '1rem')
              .css('width', '15rem')
              .css('font-weight', 'bold')
              .css('color', 'rgba(255,255,255,1)')
              .html('작업명' + $scope.item.title + '<br/>' + '작업자 수 : ' + $scope.item.workerCnt)
          );


        }




        $scope.$tmpDiv = $('<div></div>');
        $element.on('mouseenter', function (e) {
          const $div = $('<div></div>');
          if (!$attrs.value.isImportant) {
            $element.append(
              $div
                .css('position', 'absolute')
                .css('top', '1rem')
                .css('left', '3rem')
                .css('z-index', '100000')
                .css('background-color', 'rgba(0,0,0,.7)')
                .css('font-size', '1rem')
                .css('width', '15rem')
                .css('font-weight', 'bold')
                .html('작업명' + $attrs.value.title + '<br/>' + '작업자 수 : ' + $attrs.value.workerCnt)
            );
          }
        })

        $element.on('mouseleave', function (e) {
          if (!$attrs.value.isImportant) {
            $element.find('i').next().remove();
          }
        })
      },
    }
  });

  app.filter('divisionToId', function (id) {
    return '';
  });
</script>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<style>
  .dismissButton {
    display: none;
  }

  .custom-menu {
    z-index: 1000;
    position: absolute;
    background-color: rgba(0, 0, 0, .6);
    border: 0px solid black;
    color: #fff;
    width: auto;
    padding: .25rem 1rem;

  }

  :root {
    --geo-img-width: 70rem;
    --geo-img-height: 27rem;
  }

  .ts-nav-link {
    color: white !important;
    cursor: pointer;
  }

  .ts-nav-link.active {
    color: #8fc31f !important;
  }

  .geo-fullscreen-btn {
    position: absolute;
    bottom: 0;
    right: 0;
    color: white;
    border: 1px solid white;
    font-size: 1rem;
    margin: 1rem;
    cursor: pointer;
    padding: .3rem;
  }

  .fullscreen-geo {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
  }

  @-webkit-keyframes blinker {
    from {
      opacity: 1.0;
    }

    to {
      opacity: 0.0;
    }
  }

  .danger {
    text-decoration: blink;
    -webkit-animation-name: blinker;
    -webkit-animation-duration: 0.6s;
    -webkit-animation-iteration-count: infinite;
    -webkit-animation-timing-function: ease-in-out;
    -webkit-animation-direction: alternate;
    color: red !important;
  }
</style>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>

<script src="/js/ts/chart.js"></script>
<script src="/js/ts/demo.js"></script>

<div ng-app="app">

  <nav class="navbar navbar-expand navbar-dark static-top" style="height: 60px;padding:.6rem 2%;"
    ng-controller="NavCtrl">
    <a class="navbar-brand mr-1" href="index.html">
      <img class="logo_img" src="/images/nc_logo.png" alt="logo">
    </a>
    <p style="font-size:1.4rem;padding:0 1rem;margin:0;color:#fff;">디지털 안전 작업관리 시스템</p>

    <ul class="navbar-nav col-xl-9 ml-auto pl-2 pr-0">
      <li class=" dashboard-safety-nav mr-3 text-white p-2 pr-4 rounded">
        <select class="dashboard-select">
          <option ng-repeat="item in factoryNameList" v-bind="item">{{item}}</option>
        </select>
      </li>
      <li class=" dashboard-safety-nav text-white p-2 pr-4 rounded">
        <i class="fas fa-calendar-alt text-warning"></i>
        <input class="dashboard-select" type="text" ng-model="selectedDay" readonly>
      </li>

      <li class="ml-auto text-white p-2 pr-3 rounded-left dashboard-safety-nav" style="display:none;">
        오늘의 안전교육
        <i class="fas fa-hard-hat text-warning"></i>
      </li>
      <li class=" text-white p-2 pr-4 rounded-right dashboard-safety-nav" style="display:none;">
        <select class="dashboard-select">
          <option value="">안전 보호구 착용 철저1</option>
          <option value="">안전 보호구 착용 철저2</option>
          <option value="">안전 보호구 착용 철저3</option>
          <option value="">안전 보호구 착용 철저4</option>
        </select>
      </li>
    </ul>
  </nav>

  <div class="content-wrapper dashboard-wrap" ng-controller="MainCtrl">
    <div class="dashboard-container">
      <div class="row" style="height:calc(25% - 1rem)">
        <div class="col-xl-3 h-100">
          <div class="card job_situation border-0 h-100">
            <div class="card-body m-0 p-0">
              <div class="w-50 mt-2">작업 현황(일 별)</div>
              <ul>
                <li ng-repeat="item in workStatus">
                  <p>{{item.n}}</p>
                  <div>{{item.v}}</div>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-xl-9  h-100">
          <div class="card border-0 h-100">
            <div class="card-body m-0 p-0 border-0">
              <ul class="dashboard-count-wrap01 h-100">
                <li class="h-100">
                  <p>/</p>
                  <p>작업중(일 별)</p>
                  <p>전체발행작업(월 별)</p>
                </li>
                <li class="h-100" ng-repeat="item in workDivision">
                  <p><i class="fas fa-circle pr-2"></i>{{item.n}}</p>
                  <!-- working value -->

                  <p ng-click="openWorkListModal(item.id)" style="cursor:pointer;"
                    ng-class="{danger: item.n === '방사선'}">{{item.wv}}</p> <!-- fn_working -->
                  <!-- total value -->
                  <p ng-click="openTotalListModal(item.id)" style="cursor:pointer;">{{item.tv}}</p> <!-- fn_total -->
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3" style="height:calc(25% - 1rem)">
        <div class="col-xl-3 h-100">
          <div class="card job_people border-0 h-100">
            <div class="card-body m-0 p-0 h-100">
              <div class="w-50 mt-2">작업 인원(일 별)</div>
              <ul>
                <li ng-repeat="item in workPersonel">
                  <p>{{item.n}}</p>
                  <div class="" id="WORKER_TOTAL">{{item.v}}</div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-xl-9 h-100">
          <div class="card border-0 h-100">
            <div class="card-header">
              <i class="far fa-circle text-olive"></i> 작업사진
            </div>
            <div class="card-body m-0 p-4" style="height:calc(50% - 42px);">
              <ul id="ORDER_LIST_WARP" class="bxslider1 h-100 m-auto"
                style="display:flex; justify-content: space-between; padding: 0;">
                <li ng-repeat="item in workImageList"
                  style="display: inline-block !important; text-align: center; width: 15%;">
                  <img class="h-100" style="height: 95% !important; width: 100%; width: 100%;" ng-src="{{item.s}}">
                  <p style="color: white; text-align: center; margin-bottom: 0; margin-top: 0rem;">{{item.n}}</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3" style="height:calc(50% - 1rem)">
        <div class="col-xl-6 h-100" ng-class="{'col-xl-12': isFullScreenGeo ,'fullscreen-geo': isFullScreenGeo}">
          <div class="card border-0 h-100">
            <div class="card-body m-0 p-0 h-100">
              <div class="h-100 w-100" id="mapGps" style="position: absolute;" oncontextmenu='return false'>
              </div>
              <div class="card-nav" style="
			position: absolute;
			z-index: 2;">
                <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"
                  style="
			display: flex;
						    flex-direction: row !important;
						    flex-wrap: nowrap;
						    justify-content: space-between;
						    width: 100%;">
                  <a class="toggle-card-nav" href="#"><i class="fas fa-caret-square-left"></i></a>

                  <a class="nav-link ts-nav-link" ng-click="setMapIcon($event, 'all');"
                    ng-class="{active: selectedDivisionId === 'all'}">전체</a>
                  <a ng-repeat="item in workDivision" class="nav-link ts-nav-link"
                    ng-click="setMapIcon($event, item.id);"
                    ng-class="{active: selectedDivisionId === item.id}">{{item.n}}</a>
                </div>
              </div>

              <div class="card-nav-select" style="
			position: absolute;
			z-index: 2;">
                <select ng-model="selectedFacotryName" ng-change="handleChangeFactorySource();">
                  <option ng-repeat="item in factorySource" ng-value="item.n">{{item.n}}</option>
                </select>
              </div>

              <div class="h-100">
                <div class="tab-content w-100 h-100">
                  <div class="tab-pane w-100 h-100 fade show active" style="text-align: center;">
                    <img class="" ng-src="{{selectedFacotrySrc}}" style="
				width: var(--geo-img-width);
								    height: var(--geo-img-height);" />
                    <div style="
				    position: relative;
								    width: var(--geo-img-width);
								    height: var(--geo-img-height);
								    top: calc(0% - var(--geo-img-height));
								    left: 0;
								    margin: 0 auto;">
                      <div ng-repeat="item in renderMarkerList" marker-template ng-value="item"
                        ng-style="getPosition(item)" ng-style="
					position: absolute;" ng-isImportant="{{item.isImportant}}">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="geo-fullscreen-btn" ng-click="doFullScreenGeo()">
                  <i class="fas fa-compress-arrows-alt"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-6 h-100">
          <div class="card border-0" style="height:calc(50% - .5rem)">
            <div class="card-header">
              <div class="w-100 d-flex justify-content-between h-100">
                <div>
                  <i class="far fa-circle text-olive"></i> IoT 가스 센서
                </div>
                <div class="float-right d-flex align-items-center">
                  <i class="fas fa-play-circle text-white pr-2" onclick="fn_start();"
                    style="font-size:1.6rem;display:none;" id="graphStart"></i>
                  <select id="gasList" onchange="fn_gas();" class="pr-0"
                    style="color:white;border:0;background: linear-gradient(to bottom, #22282e 0%, #343a41 100%) !important; width:400px;">
                  </select>
                </div>
              </div>
            </div>

            <div class="card-body m-0 p-4" style="height:calc(50% - 10px);">
              <div class="w-100 d-flex justify-content-between h-100">
                <div chart-template chart-id="IOTChart_01" chart-text="CO2"></div>
                <div chart-template chart-id="IOTChart_02" chart-text="HC"></div>
                <div chart-template chart-id="IOTChart_03" chart-text="CO"></div>
                <div chart-template chart-id="IOTChart_04" chart-text="CO2"></div>
                <div chart-template chart-id="IOTChart_05" chart-text="H25"></div>
              </div>
            </div>
          </div>
          <div class="card border-0  mt-3" style="height:calc(50% - .5rem)">
            <div class="card-header">
              <i class="far fa-circle text-olive"></i> 오늘의 안전신문고
              <!-- <span>신고:<span>56건</span>| 완료 : <span>30건</span> </span> -->
            </div>
            <div class="card-body m-0 p-4" style="height:calc(50% - 42px);">
              <ul id="SINMUNGO_IMG_WARP" class="bxslider3 h-100 m-auto"
                style="display: flex; justify-content: space-between; padding: 0;">
                <li ng-repeat="item in sinmungoImageList">
                  <img class="w-100 h-100" ng-src="{{item.s}}" style="padding: 10px;">
                  <p>{{item.n}}</p>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="list-modal modal" tabindex="-1" role="dialog" id="list-modal" ng-controller="ListModalCtrl">
    <div class="modal-dialog modal-xl" role="document" style='max-width: 1280px;'>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">작업허가서 조회</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div>
          <table class="table table-hover">
            <colgroup>
              <col width="226px;">
              <col width="68px;">
              <col width="707px;">
              <col width="140px;">
              <col width="137px;">
            </colgroup>
            <thead>
              <tr>
                <th scope="col">발행번호</th>
                <th scope="col">구분</th>
                <th scope="col">작업명</th>
                <th scope="col">팀명</th>
                <th scope="col">발행일</th>
              </tr>
            </thead>
            <tbody id="modal_tbody">
              <tr ng-if="!isZeroListLength" ng-repeat="item in list">
                <th>{{item.no}}</th>
                <th>{{item.division}}</th>
                <th>{{item.title}}</th>
                <th>{{item.team}}</th>
                <th>{{item.regdate}}</th>
              </tr>
              <tr ng-if="isZeroListLength">
                <th colspan='5' style='text-align: center;'>진행중인 작업이 없습니다.</th>
              </tr>
            </tbody>
            <tfoot id="modal_tfoot"></tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!--Map Enlarged Image Modal-->
  <div class="list-modal modal" tabindex="-1" role="dialog" id="map_enlarged" ng-controller="MapModalCtrl">
    <div class="col-xl-12 h-100" role="document">
      <div class="modal-content h-100">
        <div class="modal-header">
          <h5 class="modal-title"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="col-xl-12 h-100">
          <div class="card border-0 h-100">
            <div class="card-body m-0 p-0 h-100">
              <div class="h-100 w-100" id="mapGps_pop" style="position: absolute;" oncontextmenu='return false'></div>
              <div class="card-nav" style="position: absolute;">
                <div class="nav flex-column nav-pills" id="v-pills-tab_pop" role="tablist" aria-orientation="vertical">
                  <a class="toggle-card-nav" href="#"><i class="fas fa-caret-square-left"></i></a>

                  <a class="nav-link active" onclick="setMap_pop('all');" id="v-pills-all-tab" data-toggle="pill"
                    href="" role="tab" aria-controls="v-pills-all" aria-selected="true">전체</a>

                  <a ng-repeat="item in workDivision" class="nav-link" onclick="setMap(1003);" id="v-pills-03-tab"
                    data-toggle="pill" href="" role="tab" aria-controls="v-pills-03" aria-selected="false">{{item.n}}
                  </a>
                </div>
              </div>

              <div class="card-nav-select" style="position: absolute;">
                <select id="selectGps_pop">
                  <option>GEO</option>
                  <option>PE</option>
                </select>&nbsp;&nbsp;
                <input type="button" class="btn btn-secondary  float-right" data-dismiss="modal" aria-label="Close"
                  value="닫기" style="width:104px;height:40px" />
              </div>

              <div class="h-100">
                <div class="tab-content w-100 h-100" id="v-pills-tabContent_pop">
                  <div class="tab-pane w-100 h-100 fade show active" id="v-all-all_pop" role="tabpanel"
                    aria-labelledby="v-pills-all-tab">
                    <img class="w-100 h-100" style="" id="FACTORY_IMG_pop" src="">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  var app = angular.module('app', []);
  app.value('wordMap', {});

  app.value('workDivision', [
    { n: '일반', id: '1001' }, //normal 
    { n: '화기', id: '1002' }, // fire
    { n: '입조', id: '1003' }, // sentryduty
    { n: '굴착', id: '1005' }, // excavation
    { n: '전기', id: '1004' }, // elec
    { n: '방사선', id: '1006' }, // radiation       	
  ]);

  app.value('factorySource', [
    { n: 'GEO', s: '/images/daesanGEO.PNG' },
    { n: 'PE', s: '/images/daesanPE.PNG' },
  ]);

  // init
  app.run(['$rootScope', 'utilService', function ($rootScope, utils) {
    // today
    $rootScope.selectedDay = utils.getTodayString();
  }]);

  app.controller('NavCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', function ($el, $rootScope, $scope, utils, ajax, wordMap) {
    // db에서 가져올 경우
    /* const factoryList = await ajax.post('/sinmungo/getFactory.do', null);
  	
    $scope.factoryNameList = [];
  	
    factoryList.forEach(function(f, i) {
      if($scope.factoryNameList.find(sf => sf === f.FACTORY ) === undefined) {			
        $scope.factoryNameList.push(f.FACTORY)
      }
    });
  	
    $scope.$apply(); */

    // 하드코딩
    $scope.factoryNameList = ['당진 화력발전소'];


  }]);

  app.controller('MainCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', 'workDivision', 'factorySource', function ($el, $rootScope, $scope, utils, ajax, wordMap, workDivision, factorySource) {
    $scope.workList = ajax.getWorkListDemo();

    $scope.factorySource = factorySource;
    $scope.selectedFacotryName = factorySource[0].n;
    $scope.selectedFacotrySrc = factorySource[0].s;

    $scope.$watch('selectedFacotryName', function (name) {
      // set image source
      const findItem = $scope.factorySource.find(function (item) {
        return item.n === name;
      });

      $scope.selectedFacotrySrc = findItem.s;

      // set marker [all]
      $scope.renderMarkerList = $scope.markerList.filter(function (m) {
        return m.factory === name;
      });

      $scope.selectedDivisionId = 'all';
    });

    // 작업현황 : 일별
    $scope.workStatus = [
      { n: '전체', v: 0 },
      { n: '진행중', v: 0 },
      { n: '완료', v: 0 },
      // {n: '대기', v: 0},
    ];

    // 작업인원 : 일별
    $scope.workPersonel = [
      { n: '투입', v: 0 },
      { n: '작업중', v: 0 },
      { n: '작업완료', v: 0 }
    ];

    // 작업별 작업횟수
    // wv(working value) : 일별, tv(totalValue) : 월별
    $scope.workDivision = workDivision;

    // 작업목록 하드코딩
    $scope.workImageList = [
      { n: '전기 작업_202011501', s: '/images/ts/sm1.jpg' },
      { n: '굴착 작업_202011502', s: '/images/ts/sm2.jpg' },
      { n: '화기 작업_202011503', s: '/images/ts/sm3.jpg' },
      { n: '화기 작업_202011504', s: '/images/ts/sm4.jpg' },
      { n: '일반작업_2020111505 ', s: '/images/ts/sm5.jpg' },
      { n: '일반작업_2020111505 ', s: '/images/ts/sm6.jpg' },
    ];

    // 신문고 사진 목록 하드코딩
    $scope.sinmungoImageList = [
      { n: 'A구역 | 기계오작동', s: '/images/ts/sm9.png' },
      { n: 'B구역 | 기계오작동', s: '/images/ts/sm5.jpg' },
      { n: 'A구역 | 수리요청', s: '/images/ts/sm6.jpg' },
      { n: 'B구역 | 수리요청', s: '/images/ts/sm7.jpg' },
      { n: 'C구역 | 기타', s: '/images/ts/sm8.jpg' },
    ];

    // list modal
    $scope.openWorkListModal = async function (workcd) {
      // var workList = await ajax.post('/lotte/ts/getworkinglist.nDo', {"WORKCD":  workcd});
      const workList = $scope.workList.filter(function (w) {
        return w.id === workcd;
      });

      $rootScope.$emit('get:workList', workList);
    }

    $scope.openTotalListModal = async function (workcd) {
      // var workList = await ajax.post('/lotte/ts/gettotallist.nDo', {"WORKCD":  workcd});
      $rootScope.$emit('get:workList', workList);
    }

    $scope.markerList = $scope.workList.map(function (w) {
      return {
        top: w.top,
        left: w.left,
        id: w.id,
        title: w.title,
        factory: w.factory,
        workerCnt: w.workerCnt,
        isImportant: w.important
      }
    });
    $scope.selectedDivisionId = 'all';

    /* [
         {top: 33, left: 12, id: '1001', factory: 'PE', workCnt: 1},
         {top: 8, left: 10, id: '1002', factory: 'PE', workCnt: 3},
         {top: 40, left: 10, id: '1003', factory: 'PE', workCnt: 3},
         {top: 20, left: 10, id: '1003', factory: 'PE', workCnt: 1},
         {top: 30, left: 60, id: '1004', factory: 'PE', workCnt: 2},
         {top: 50, left: 40, id: '1005', factory: 'PE', workCnt: 1},
         {top: 30, left: 5, id: '1004', factory: 'PE', workCnt: 3},
         {top: 80, left: 25, id: '1006', factory: 'PE', workCnt: 4},
         
         {top: 30, left: 30, id: '1001', factory: 'GEO', workCnt: 1},
         {top: 10, left: 34, id: '1001', factory: 'GEO', workCnt: 1},
         {top: 23, left: 33, id: '1001', factory: 'GEO', workCnt: 1},
         {top: 40, left: 2, id: '1002', factory: 'GEO', workCnt: 2},
         {top: 30, left: 70, id: '1003', factory: 'GEO', workCnt: 5},
         {top: 20, left: 10, id: '1004', factory: 'GEO', workCnt: 1},
         {top: 30, left: 20, id: '1005', factory: 'GEO', workCnt: 2},
         {top: 40, left: 30, id: '1006', factory: 'GEO', workCnt: 3},
       ]; */

    $scope.renderMarkerList = $scope.markerList.filter(function (m) {
      return m.factory === $scope.selectedFacotryName;
    });

    $scope.getPosition = function (item) {
      let color = 'rgba(100, 100, 100, 1)';
      switch (item.id) {
        case '1001': // 일반
          color = '#2f7fb4';
          break;
        case '1002': // 화기
          color = '#af2f74';
          break;
        case '1003': // 입조
          color = '#5e9213';
          break;
        case '1004': // 전기
          color = '#b17702';
          break;
        case '1005': // 굴착
          color = '#8d43b9';
          break;
        case '1006': // 방사선
          color = '#dd0b2e';
          break;
      }


      return { top: item.top + '%', left: item.left + '%', color: color };
    }

    $scope.setMapIcon = function (e, id) {
      $scope.selectedDivisionId = id;

      const markerList = $scope.markerList.filter(function (m) {
        return m.factory === $scope.selectedFacotryName;
      });

      if (id === 'all') {
        $scope.renderMarkerList = markerList;
        return;
      }

      $scope.renderMarkerList = markerList.filter(function (m) {
        return m.id === id;
      });

    }

    $scope.isFullScreenGeo = false;
    $scope.doFullScreenGeo = function () {
      $scope.isFullScreenGeo = !$scope.isFullScreenGeo;
      console.log('$scope.isFullScreenGeo', $scope.isFullScreenGeo)

      if ($scope.isFullScreenGeo) {
        document.documentElement.style.setProperty('--geo-img-width', '100rem');
        document.documentElement.style.setProperty('--geo-img-height', '75rem');
      } else {
        document.documentElement.style.setProperty('--geo-img-width', '70rem');
        document.documentElement.style.setProperty('--geo-img-height', '27rem');
      }
    }

    init();

    async function init() {
      /*
      const {
        CURRENT_COUNT,
        CURRENT_WORKER_COUNT,
        TOTAL_COUNT,
        TOTAL_WORK_COUNT,
      } = await ajax.get('/lotte/selectDashBoardCount.nDo');
      */
      console.log('init markerlist!', $scope.markerList);

      let workerCnt = 0;
      for (item of $scope.markerList) {
        workerCnt += item.workerCnt
      }

      const {
        CURRENT_COUNT,
        CURRENT_WORKER_COUNT,
        TOTAL_COUNT,
        TOTAL_WORK_COUNT,
      } = {
        CURRENT_COUNT: {
          COMPLETED: 3,
          RUNNING: $scope.markerList.length,
          WAITING: 1,
        },
        CURRENT_WORKER_COUNT: {
          COMPLECOUNT: 13,
          NOWCNT: workerCnt,
        },
        TOTAL_COUNT: {
          NORMAL_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1001' }).length,
          FIRE_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1002' }).length,
          SENTRYDUTY_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1003' }).length,
          ELEC_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1004' }).length,
          EXCAVATION_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1005' }).length,
          RADIATION_TOTAL: $scope.markerList.filter(function (m) { return m.id === '1006' }).length,
        },
        TOTAL_WORK_COUNT: {
          ELEC_WORKING: 20,
          EXCAVATION_WORKING: 10,
          FIRE_WORKING: 40,
          NORMAL_WORKING: 20,
          RADIATION_WORKING: 22,
          SENTRYDUTY_WORKING: 15,
        },
      };

      // db set
      $scope.workStatus.find(w => w.n === '전체').v = CURRENT_COUNT.COMPLETED + CURRENT_COUNT.RUNNING + CURRENT_COUNT.WAITING
      $scope.workStatus.find(w => w.n === '진행중').v = CURRENT_COUNT.RUNNING
      $scope.workStatus.find(w => w.n === '완료').v = CURRENT_COUNT.COMPLETED
      // $scope.workStatus.find(w => w.n === '대기').v = CURRENT_COUNT.WAITING

      $scope.workPersonel.find(w => w.n === '투입').v = CURRENT_WORKER_COUNT.NOWCNT + CURRENT_WORKER_COUNT.COMPLECOUNT;
      $scope.workPersonel.find(w => w.n === '작업중').v = CURRENT_WORKER_COUNT.NOWCNT;
      $scope.workPersonel.find(w => w.n === '작업완료').v = CURRENT_WORKER_COUNT.COMPLECOUNT;

      const ELEC_TOTAL = $scope.workDivision.find(wc => wc.n === '전기');
      const EXCAVATION_TOTAL = $scope.workDivision.find(wc => wc.n === '굴착');
      const FIRE_TOTAL = $scope.workDivision.find(wc => wc.n === '화기');
      const NORMAL_TOTAL = $scope.workDivision.find(wc => wc.n === '일반');
      const RADIATION_TOTAL = $scope.workDivision.find(wc => wc.n === '방사선');
      const SENTRYDUTY_TOTAL = $scope.workDivision.find(wc => wc.n === '입조');

      ELEC_TOTAL.wv = TOTAL_COUNT.ELEC_TOTAL;
      ELEC_TOTAL.tv = TOTAL_WORK_COUNT.ELEC_WORKING;

      EXCAVATION_TOTAL.wv = TOTAL_COUNT.EXCAVATION_TOTAL;
      EXCAVATION_TOTAL.tv = TOTAL_WORK_COUNT.EXCAVATION_WORKING;

      FIRE_TOTAL.wv = TOTAL_COUNT.FIRE_TOTAL;
      FIRE_TOTAL.tv = TOTAL_WORK_COUNT.FIRE_WORKING;

      NORMAL_TOTAL.wv = TOTAL_COUNT.NORMAL_TOTAL;
      NORMAL_TOTAL.tv = TOTAL_WORK_COUNT.NORMAL_WORKING;

      RADIATION_TOTAL.wv = TOTAL_COUNT.RADIATION_TOTAL;
      RADIATION_TOTAL.tv = TOTAL_WORK_COUNT.RADIATION_WORKING;

      SENTRYDUTY_TOTAL.wv = TOTAL_COUNT.SENTRYDUTY_TOTAL;
      SENTRYDUTY_TOTAL.tv = TOTAL_WORK_COUNT.SENTRYDUTY_WORKING;

      const bodyObj = {
        search_date_start: $rootScope.selectedDay,
        search_date_end: $rootScope.selectedDay,
        search_impo_type: "",
        search_report_title: "",

        search_action_status: "",
        search_department: "",
        search_position: ""
      }

      // const cntGraph = await ajax.post('/sinmungo/ts/getCntGraph.nDo', bodyObj);

      //demo code - 하드코딩...
      fn_makeIOTChart(getChartDemoDataAll());
    }

  }]);
  app.controller('ListModalCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', function ($el, $rootScope, $scope, utils, ajax, wordMap) {
    $scope.list = [];
    $scope.isZeroListLength = true;

    $rootScope.$on('get:workList', function (_, list) {
      console.log('get:workList', list);
      $scope.list = list;

      $el.modal('show');
    });

    $scope.$watch('list', function (list) {
      console.log(list);
      $scope.isZeroListLength = list.length === 0;
      console.log('zerolength', $scope.isZeroListLength);
    })


  }]);

  app.controller('MapModalCtrl', ['$element', '$rootScope', '$scope', 'utilService', 'ajaxFacotry', 'wordMap', 'workDivision', function ($el, $rootScope, $scope, utils, ajax, wordMap, workDivision) {
    $scope.workDivision = workDivision;
  }]);


  app.service('utilService', function () {
    this.reverse = function (name) {
      return name.split("").reverse().join("");
    };

    this.getTodayString = function () {
      var today = new Date();
      var dd = today.getDate();
      var mm = today.getMonth() + 1;
      var yyyy = today.getFullYear();

      dd = dd < 10 ? '0' + dd : dd;
      mm = mm < 10 ? '0' + mm : mm;

      today = yyyy + '-' + mm + '-' + dd;

      return today;
    };


  });

  app.factory('ajaxFacotry', function ($compile) {
    return {
      get: function (url, params, preResCb, preRejCb) {
        return new Promise(function (res, rej) {
          $.ajax({
            url: url,
            contentType: "application/json",
            dataType: 'json',
            params: params,
            success: function (result) {
              if (typeof (preResCb) === 'function') preResCb();
              res(result);
            },
            error: function (err) {
              if (typeof (preRejCb) === 'function') preRejCb();
              rej(err);
            }
          });
        });
      },
      post: function (url, data, preResCb, preRejCb) {
        return new Promise(function (res, rej) {
          $.ajax({
            url: url,
            type: 'POST',
            contentType: "application/json",
            dataType: 'json',
            data: data,
            success: function (result) {
              if (typeof (preResolveCb) === 'function') preResolveCb();
              res(result);
            },
            error: function (err) {
              if (typeof (preRejectCb) === 'function') preRejectCb();
              rej(err);
            }
          });
        });
      },
      getWorkListDemo: function () {
        // hard coding
        return [
          { no: 1, id: '1002', division: '화기', title: '[PE] 공장 뒤 용접작업', team: 'A팀', regdate: '2020-11-20', workerCnt: 2, top: 3, left: 77, factory: 'PE', important: false },
          { no: 2, id: '1001', division: '일반', title: '[GEO] 작업장 뒤 용접작업', team: 'B팀', regdate: '2020-11-21', workerCnt: 4, top: 22, left: 56, factory: 'GEO', important: false },
          { no: 3, id: '1001', division: '일반', title: '[PE] 쓰레기 청소작업', team: 'C팀', regdate: '2020-11-21', workerCnt: 3, top: 15, left: 78, factory: 'PE', important: false },
          { no: 4, id: '1004', division: '전기', title: '[GEO] 1층 전선작업', team: 'Z팀', regdate: '2020-11-21', workerCnt: 2, top: 20, left: 55, factory: 'GEO', important: false },
          { no: 5, id: '1005', division: '굴착', title: '[PE] 공장 앞 굴착 작업', team: 'E팀', regdate: '2020-11-21', workerCnt: 1, top: 67, left: 43, factory: 'PE', important: false },
          { no: 6, id: '1003', division: '입조', title: '[PE] 작업장 뒤 입조작업', team: 'R팀', regdate: '2020-11-21', workerCnt: 3, top: 30, left: 22, factory: 'PE', important: false },
          { no: 7, id: '1001', division: '일반', title: '[GEO] 기타 일반작업', team: 'A팀', regdate: '2020-11-21', workerCnt: 5, top: 28, left: 41, factory: 'GEO', important: false },
          { no: 8, id: '1004', division: '전기', title: '[PE] 작업장 뒤 전기작업', team: 'E팀', regdate: '2020-11-21', workerCnt: 2, top: 77, left: 6, factory: 'PE', important: false },
          { no: 9, id: '1002', division: '화기', title: '[PE] 소화 시설 테스트', team: 'A팀', regdate: '2020-11-21', workerCnt: 3, top: 65, left: 98, factory: 'PE', important: false },
          { no: 10, id: '1001', division: '일반', title: '[GEO] 시설물 교육', team: 'B팀', regdate: '2020-11-21', workerCnt: 4, top: 46, left: 7, factory: 'GEO', important: false },
          { no: 11, id: '1002', division: '화기', title: '[GEO] 작업장 뒤 용접작업', team: 'E팀', regdate: '2020-11-21', workerCnt: 5, top: 79, left: 43, factory: 'GEO', important: false },
          { no: 12, id: '1006', division: '방사선', title: '[PE] * 방사선 작업', team: 'D팀', regdate: '2020-11-21', workerCnt: 2, top: 27, left: 68, factory: 'PE', important: false },
          { no: 13, id: '1004', division: '전기', title: '[PE] 건물 내 전기작업', team: 'A팀', regdate: '2020-11-22', workerCnt: 1, top: 47, left: 34, factory: 'PE', important: false },
          { no: 14, id: '1003', division: '입조', title: '[GEO] 제초 작업', team: 'F팀', regdate: '2020-11-22', workerCnt: 3, top: 4, left: 23, factory: 'GEO', important: false },
          { no: 15, id: '1001', division: '일반', title: '[PE] 안전 작업', team: 'K팀', regdate: '2020-11-22', workerCnt: 4, top: 87, left: 56, factory: 'PE', important: true },
          { no: 16, id: '1006', division: '방사선', title: '[GEO] * 방사선 작업', team: 'E팀', regdate: '2020-11-22', workerCnt: 1, top: 56, left: 76, factory: 'GEO', important: false },
          { no: 17, id: '1002', division: '화기', title: '[PE] 일반 화기 작업', team: 'F팀', regdate: '2020-11-22', workerCnt: 3, top: 53, left: 36, factory: 'PE', important: false },
          { no: 18, id: '1002', division: '화기', title: '[PE] 화기작업시 안전교육', team: 'Z팀', regdate: '2020-11-22', workerCnt: 3, top: 80, left: 56, factory: 'PE', important: false },
          { no: 19, id: '1005', division: '굴착', title: '[GEO] 굴착기 테스트', team: 'Y팀', regdate: '2020-11-22', workerCnt: 2, top: 34, left: 34, factory: 'GEO', important: true },
          { no: 20, id: '1003', division: '입조', title: '[PE] 입조 작업', team: 'E팀', regdate: '2020-11-22', workerCnt: 2, top: 76, left: 23, factory: 'PE', important: false },
          { no: 21, id: '1004', division: '전기', title: '[GEO] 전체 전선 테스트', team: 'B팀', regdate: '2020-11-22', workerCnt: 4, top: 27, left: 43, factory: 'GEO', important: false },
          { no: 22, id: '1001', division: '일반', title: '[GEO] 기타 일반작업', team: 'C팀', regdate: '2020-11-23', workerCnt: 5, top: 69, left: 78, factory: 'GEO', important: false },
          { no: 23, id: '1005', division: '굴착', title: '[PE] 실외 굴착 작업', team: 'R팀', regdate: '2020-11-23', workerCnt: 2, top: 81, left: 63, factory: 'PE', important: false },
          { no: 24, id: '1001', division: '일반', title: '[PE] 화장실 청소 작업', team: 'D팀', regdate: '2020-11-23', workerCnt: 3, top: 34, left: 33, factory: 'PE', important: false },
          { no: 25, id: '1004', division: '전기', title: '[GEO] 전선 정리작업', team: 'E팀', regdate: '2020-11-23', workerCnt: 1, top: 66, left: 23, factory: 'GEO', important: false },
          { no: 26, id: '1004', division: '전기', title: '[PE] 전선 정리작업', team: 'Q팀', regdate: '2020-11-23', workerCnt: 2, top: 34, left: 13, factory: 'PE', important: false },
        ]
      }
    }
  });

  app.directive('chartTemplate', function () {
    return {
      restrict: 'A',
      template: `
	<div class="" style="width:100%; height:100%; border-radius:10px;">
	<div class="chart-div" style="width : 90%;  height : 90%; margin-right:2%;"></div>
	<div class="chart-text"style="width : 100%;  height : 10%; color:white; text-align:center;">
		<span>template</span>
	</div>
    </div>
    `,
      priority: 0,
      transclude: false,
      scope: false,
      controller: function ($scope, $element, $attrs, $transclude) {
        $element.css('flex', '1');
        $element.find('.chart-div').attr('id', $attrs.chartId);
        $element.find('.chart-text').find('span').text($attrs.chartText);
      },
    };
  });

  app.directive('markerTemplate', function () {
    return {
      restrict: 'A',
      template: `
		<i class="fas fa-map-marker-alt"></i>
	`,
      priority: 0,
      transclude: false,
      scope: false,
      controller: function ($scope, $element, $attrs, $transclude) {
        $element
          .css('display', 'inline-block')
          .css('position', 'absolute')
          // .css('color', 'rgba(255,80,80,1)')
          .css('fontSize', '3rem');

        if ($scope.item.isImportant) {
          $element.find('i')
            .css('transform', 'scale(1.3)')
            .addClass('danger');
          //	.css('border', '1px solid red');


          const $div = $('<div></div>');

          $element.append(
            $div
              .css('position', 'absolute')
              .css('top', '1rem')
              .css('left', '3rem')
              .css('z-index', '100000')
              .css('background-color', 'rgba(10,0,0,.7)')
              .css('font-size', '1rem')
              .css('width', '15rem')
              .css('font-weight', 'bold')
              .css('color', 'rgba(255,255,255,1)')
              .html('작업명' + $scope.item.title + '<br/>' + '작업자 수 : ' + $scope.item.workerCnt)
          );


        }




        $scope.$tmpDiv = $('<div></div>');
        $element.on('mouseenter', function (e) {
          const $div = $('<div></div>');
          if (!$attrs.value.isImportant) {
            $element.append(
              $div
                .css('position', 'absolute')
                .css('top', '1rem')
                .css('left', '3rem')
                .css('z-index', '100000')
                .css('background-color', 'rgba(0,0,0,.7)')
                .css('font-size', '1rem')
                .css('width', '15rem')
                .css('font-weight', 'bold')
                .html('작업명' + $attrs.value.title + '<br/>' + '작업자 수 : ' + $attrs.value.workerCnt)
            );
          }
        })

        $element.on('mouseleave', function (e) {
          if (!$attrs.value.isImportant) {
            $element.find('i').next().remove();
          }
        })
      },
    }
  });

  app.filter('divisionToId', function (id) {
    return '';
  });
</script>